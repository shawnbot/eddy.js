(function(exports){var eddy={version:"2.0.1"};eddy.util={sum:function(e,t){return typeof t=="function"&&(e=e.map(t)),e.reduce(function(e,t){return e+t},0)}},eddy.dispatch=function(e){var t={};return e.on=function(n,r,i){return n in t?t[n].push({fn:r,context:i}):t[n]=[{fn:r,context:i}],e},e.off=function(n,r){var i=t[n];if(i&&i.length){var s=i.length;for(var o=0;o<s;o++)i[o].fn===r&&(i.splice(o,1),o--)}return e},e.dispatch=function(e){var n=typeof e=="string"?e:e.type,r=t[n];if(r&&r.length){var i=r.length,s=Array.prototype.slice.call(arguments,1);for(var o=0;o<i;o++){var u=r[o].fn.apply(r[o].context,s);if(u===!1)return!1}}return!0}},eddy.loader=function(e){function f(){return r?(clearTimeout(r),!0):!1}function l(e,t){u.uri=e,u.wait=t;if(t>0){var n=t*1e3;return o>n?console.warn("latency > timeout:",(o/1e3).toFixed(2)+"s vs.",(n/1e3).toFixed(2)+"s","; ignoring!"):n-=o,setTimeout(function(){a.load(e)},n)}return setTimeout(function(){a.load(e)},1)}if(typeof e!="object")throw"eddy.loader() expects an options object; got "+typeof e;var t=e.baseURL,n=e.lastURI,r=null,i=0,s=10,o=0,u={},a={};return eddy.dispatch(a),a.callback=function(e){var t=e.split(".");return t[0].replace(/[^\w]/g,"_")},a.request=function(e,n,r){var i=t+e,s=a.callback(e);return reqwest({url:i,type:"jsonp",jsonpCallbackName:s,success:n,error:r})},a.start=function(e){return f(),a.load(e||n)},a.stop=function(e){f(),a.dispatch("stop",{message:e})},a.load=function(e){f();var t=Date.now();return a.dispatch("loading",{uri:e}),a.request(e,function(n){var s=s=Date.now()-t;console.info("load took:",(s/1e3).toFixed(2),"seconds",e),i=0,a.dispatch("load",n);var o=n.next?n.next.href:null,u=n.next?n.next.wait:null;o?r=l(o,u):a.stop("No next.href in response")},function(t){if(i>=s)a.stop("Too many retries ("+i+")");else{a.dispatch("error",{message:t.statusText});var n=u.wait||10;console.warn("error loading; retrying in",n,"seconds..."),r=l(e,n),i++}})},a},eddy.unpack={},eddy.unpack.history=function(e){if(!e.history)return!1;var t=eddy.util.sum(e.history),n=0;e.currentUsage?n=e.currentUsage.count:n=t;var r=n-t;return e.history=eddy.unpack.runningHistory(e.history,r,e.time),!0},eddy.unpack.filters=function(e){eddy.unpack.usages(e),eddy.unpack.history(e);if(!e.filters)return!1;var t={};e.filters.forEach(function(e){t[e.name]=e,e.usage||(e.usage={})}),e.filtersByName=t;if(e["filter usage"]instanceof Array){e["filter usage"].forEach(function(e){var n=e.label;for(var r in e.counts)r in t?t[r].usage[n]=e.counts[r]:console.warn("filter usage (no filter):",r,e.counts[r])});if(e.currentUsage){var n=e.currentUsage.label;e.filters.forEach(function(e){e.count=e.usage[n]})}}return e.filters.forEach(function(t){t.id||(t.id=t.name.replace(/\W+/g,"_").toLowerCase()),t.tpm=t.history[t.history.length-1];var n=eddy.util.sum(t.history);t.total||(t.total=n);var r=t.total-n;r<0&&(console.warn("negative running count start:",r,"(count:",t.total,"; sum history:",n,")"),r=0),t.counts=t.history.slice(),t.history=eddy.unpack.runningHistory(t.history,r,e.time)}),!0},eddy.unpack.minutes=function(e){eddy.unpack.usages(e);if(!e.filters||!e.minutes)return!1;var t={};return e.filters.forEach(function(e){t[e.id]=e}),e.minutes.forEach(function(e){e.filters=e.filters.map(function(e){return{filter:t[e[0]],count:e[1]}})}),e.history=e.minutes.map(function(e){return e.tweets.count}),eddy.unpack.history(e),!0},eddy.unpack.retweets=function(e){eddy.unpack.usages(e),eddy.unpack.history(e)},eddy.unpack.usages=function(e){function s(e){return e.start<=n&&e.end>=n||e.end>=n&&e.end<=i}if(!e.history||!e.usage)return!1;var t=e.time,n=t.start||t.start_time,r=t.period,i=n+r*(e.history.length-1),o=null,u=e.usage.sort(function(e,t){var n=t.end-e.end,r=t.start-e.start;return n||r}),a=e.usage.sort(function(e,t){return t.count-e.count});return u.forEach(function(e){e.active=s(e),e.active&&(o=e)}),e.currentUsage=o,e.biggestUsage=a[0],!0},eddy.unpack.runningHistory=function(e,t,n){var r=t,i=n.start_time,s=n.period;return e.map(function(e){var t=i;return i+=s,r+=e,{count:e,time:t,running:r}})},eddy.util.qs={parse:function(e){e.charAt(0)==="?"&&(e=e.substr(1));if(e.length===0||e.indexOf("=")===-1)return{};var t=e.split("&"),n=t.length;params={};for(var r=0;r<n;r++){var i=t[r].split("=");params[decodeURIComponent(i[0])]=i.length===2?decodeURIComponent(i[1]):!0}return params},format:function(e){var t=[],n=0;for(var r in e){n++>0&&t.push("&");var i=e[r];i!==null&&t.push(encodeURIComponent(r),"=",encodeURIComponent(i))}return t.join("")}},exports.eddy=eddy,window.console||function(e){function t(){}for(var n=["error","info","log","warn"],r;r=n.pop();)e[r]=e[r]||t}(window.console=window.console={}),!function(e,t){typeof module!="undefined"?module.exports=t():typeof define=="function"&&define.amd?define(e,t):this[e]=t()}("reqwest",function(){function handleReadyState(e,t,n){return function(){e&&e[readyState]==4&&(twoHundo.test(e.status)?t(e):n(e))}}function setHeaders(e,t){var n=t.headers||{},r;n.Accept=n.Accept||defaultHeaders.accept[t.type]||defaultHeaders.accept["*"],!t.crossOrigin&&!n[requestedWith]&&(n[requestedWith]=defaultHeaders.requestedWith),n[contentType]||(n[contentType]=t.contentType||defaultHeaders.contentType);for(r in n)n.hasOwnProperty(r)&&e.setRequestHeader(r,n[r])}function generalCallback(e){lastValue=e}function urlappend(e,t){return e+(/\?/.test(e)?"&":"?")+t}function handleJsonp(e,t,n,r){var i=uniqid++,s=e.jsonpCallback||"callback",o=e.jsonpCallbackName||"reqwest_"+i,u=new RegExp("((^|\\?|&)"+s+")=([^&]+)"),a=r.match(u),f=doc.createElement("script"),l=0;a?a[3]==="?"?r=r.replace(u,"$1="+o):o=a[3]:r=urlappend(r,s+"="+o),win[o]=generalCallback,f.type="text/javascript",f.src=r,f.async=!0,typeof f.onreadystatechange!="undefined"&&(f.event="onclick",f.htmlFor=f.id="_reqwest_"+i),f.onload=f.onreadystatechange=function(){if(f[readyState]&&f[readyState]!=="complete"&&f[readyState]!=="loaded"||l)return!1;f.onload=f.onreadystatechange=null,f.onclick&&f.onclick(),e.success&&e.success(lastValue),lastValue=undefined,head.removeChild(f),l=1},head.appendChild(f)}function getRequest(e,t,n){var r=(e.method||"GET").toUpperCase(),i=typeof e=="string"?e:e.url,s=e.processData!==!1&&e.data&&typeof e.data!="string"?reqwest.toQueryString(e.data):e.data||null,o;return(e.type=="jsonp"||r=="GET")&&s&&(i=urlappend(i,s),s=null),e.type=="jsonp"?handleJsonp(e,t,n,i):(o=xhr(),o.open(r,i,!0),setHeaders(o,e),o.onreadystatechange=handleReadyState(o,t,n),e.before&&e.before(o),o.send(s),o)}function Reqwest(e,t){this.o=e,this.fn=t,init.apply(this,arguments)}function setType(e){var t=e.match(/\.(json|jsonp|html|xml)(\?|$)/);return t?t[1]:"js"}function init(o,fn){function complete(e){o.timeout&&clearTimeout(self.timeout),self.timeout=null,o.complete&&o.complete(e)}function success(resp){var r=resp.responseText;if(r)switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r}fn(resp),o.success&&o.success(resp),complete(resp)}function error(e,t,n){o.error&&o.error(e,t,n),complete(e)}this.url=typeof o=="string"?o:o.url,this.timeout=null;var type=o.type||setType(this.url),self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort()},o.timeout)),this.request=getRequest(o,success,error)}function reqwest(e,t){return new Reqwest(e,t)}function normalize(e){return e?e.replace(/\r?\n/g,"\r\n"):""}function serial(e,t){var n=e.name,r=e.tagName.toLowerCase(),i=function(e){e&&!e.disabled&&t(n,normalize(e.attributes.value&&e.attributes.value.specified?e.value:e.text))};if(e.disabled||!n)return;switch(r){case"input":if(!/reset|button|image|file/i.test(e.type)){var s=/checkbox/i.test(e.type),o=/radio/i.test(e.type),u=e.value;(!s&&!o||e.checked)&&t(n,normalize(s&&u===""?"on":u))}break;case"textarea":t(n,normalize(e.value));break;case"select":if(e.type.toLowerCase()==="select-one")i(e.selectedIndex>=0?e.options[e.selectedIndex]:null);else for(var a=0;e.length&&a<e.length;a++)e.options[a].selected&&i(e.options[a])}}function eachFormElement(){var e=this,t,n,r,i=function(t,n){for(var i=0;i<n.length;i++){var s=t[byTag](n[i]);for(r=0;r<s.length;r++)serial(s[r],e)}};for(n=0;n<arguments.length;n++)t=arguments[n],/input|select|textarea/i.test(t.tagName)&&serial(t,e),i(t,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var e={};return eachFormElement.apply(function(t,n){t in e?(e[t]&&!isArray(e[t])&&(e[t]=[e[t]]),e[t].push(n)):e[t]=n},arguments),e}var win=window,doc=document,twoHundo=/^20\d$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,lastValue,xmlHttpRequest="XMLHttpRequest",isArray=typeof Array.isArray=="function"?Array.isArray:function(e){return e instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"},requestedWith:xmlHttpRequest},xhr=win[xmlHttpRequest]?function(){return new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")};return Reqwest.prototype={abort:function(){this.request.abort()},retry:function(){init.call(this,this.o,this.fn)}},reqwest.serializeArray=function(){var e=[];return eachFormElement.apply(function(t,n){e.push({name:t,value:n})},arguments),e},reqwest.serialize=function(){if(arguments.length===0)return"";var e,t,n=Array.prototype.slice.call(arguments,0);return e=n.pop(),e&&e.nodeType&&n.push(e)&&(e=null),e&&(e=e.type),e=="map"?t=serializeHash:e=="array"?t=reqwest.serializeArray:t=serializeQueryString,t.apply(null,n)},reqwest.toQueryString=function(e){var t="",n,r=encodeURIComponent,i=function(e,n){t+=r(e)+"="+r(n)+"&"};if(isArray(e))for(n=0;e&&n<e.length;n++)i(e[n].name,e[n].value);else for(var s in e){if(!Object.hasOwnProperty.call(e,s))continue;var o=e[s];if(isArray(o))for(n=0;n<o.length;n++)i(s,o[n]);else i(s,e[s])}return t.replace(/&$/,"").replace(/%20/g,"+")},reqwest.compat=function(e,t){return e&&(e.type&&(e.method=e.type)&&delete e.type,e.dataType&&(e.type=e.dataType),e.jsonpCallback&&(e.jsonpCallbackName=e.jsonpCallback)&&delete e.jsonpCallback,e.jsonp&&(e.jsonpCallback=e.jsonp)),new Reqwest(e,t)},reqwest})})(this);