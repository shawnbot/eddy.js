(function(e){!window.console&&function(e){function t(){}for(var n=["error","info","log","warn"],r;r=n.pop();)e[r]=e[r]||t}(window.console={});var t={version:"2.5.0"};t.util={sum:function(e,t){return typeof t=="function"&&(e=e.map(t)),e.reduce(function(e,t){return e+t},0)},keys:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&typeof e[n]!="function"&&t.push(n);return t},numor:function(e,t){var n=+e;return isNaN(n)?t:n},merge:function(e,n,r){var i=Array.prototype.slice.call(arguments,1);return i.forEach(function(n){if(typeof n=="object"){var r=t.util.keys(n);r.forEach(function(t){e[t]=n[t]})}}),e}},t.dispatch=function(e){var t={};return e.on=function(n,r,i){return n in t?t[n].push({fn:r,context:i}):t[n]=[{fn:r,context:i}],e},e.off=function(n,r){var i=t[n];if(i&&i.length){var s=i.length;for(var o=0;o<s;o++)i[o].fn===r&&(i.splice(o,1),o--)}return e},e.dispatch=function(e){var n=typeof e=="string"?e:e.type,r=t[n];if(r&&r.length){var i=r.length,s=Array.prototype.slice.call(arguments,1);for(var o=0;o<i;o++){var u=r[o].fn.apply(r[o].context,s);if(u===!1)return!1}}return!0}},t.request=function(e){var t=!1,n=function(){t=!0};switch(e.type){case"jsonp":var r=document.createElement("script"),i=e.jsonpCallbackName||"callback";r.src=e.url,r.async=!0,r.className="eddy-jsonp",r.onerror=function(){s(),e.error&&e.error.apply(null,arguments)};function s(){r.parentNode&&r.parentNode.removeChild(r),i in window&&delete window[i]}n=function(){t=!0,s()},window[i]=function(){s(),t||e.success&&e.success.apply(null,arguments)},document.getElementsByTagName("script")[0].parentNode.appendChild(r);break;default:throw"Unsupported request type: "+e.type}return{abort:n}},t.loader=function(e){function l(){clearTimeout(i)}function c(e,t){a.uri=e,a.wait=t;if(t>0){var n=t*1e3;return u>n?console.warn("latency > timeout:",(u/1e3).toFixed(2)+"s vs.",(n/1e3).toFixed(2)+"s","; ignoring!"):n-=u,setTimeout(function(){f.load(e)},n)}return setTimeout(function(){f.load(e)},1)}if(typeof e!="object")throw"eddy.loader() expects an options object; got "+typeof e;var n=e.baseURL,r=e.lastURI,i=null,s=0,o=10,u=0,a={},f={};return t.dispatch(f),f.callback=function(e){var t=e.split(".");return t[0].replace(/[^\w]/g,"_")},f.request=function(e,r,i){var s=n+e,o=f.callback(e);return t.request({url:s,type:"jsonp",jsonpCallbackName:o,success:r,error:i})},f.start=function(e){return l(),f.load(e||r)},f.stop=function(e){l(),f.dispatch("stop",{message:e})},f.load=function(e){l();var t=Date.now();return f.dispatch("loading",{uri:e}),f.request(e,function(e){var n=n=Date.now()-t;s=0;var r=e.next?e.next.href:null,o=e.next?e.next.wait:null;r?i=c(r,o):f.stop("No next.href in response"),f.dispatch("load",e)},function(t){if(s>=o)f.stop("Too many retries ("+s+")");else{f.dispatch("error",{message:t.statusText});var n=a.wait||10;console.warn("error loading; retrying in",n,"seconds..."),i=c(e,n),s++}})},f},t.unpack={},t.unpack.history=function(e){if(!e.history)return console.warn("no history in data; not unpacking"),!1;if(typeof e.history[0]=="object")return console.warn("data.history[0] is an object; not unpacking again"),!1;var n=t.util.sum(e.history),r=0;e.currentUsage?r=e.currentUsage.count:r=n;var i=r-n;i<0&&console.warn("negative start for running total! current count:",r,"sum history:",n),e.history=t.unpack.runningTotal(e.history,i,e.time);if(e.usage){var s=e.usage.slice().sort(function(e,t){return d3.ascending(e.start,t.start)||d3.ascending(e.total,t.total)});s.forEach(function(n){var r=e.history.filter(function(e){return e.time>=n.start&&e.time<=n.end}),i=r.length,s=t.util.sum(r.map(function(e){return e.count})),o=n.count;for(var u=i-1;u>=0;u--){var a=r[u];a.total=o,a.usage=n,o-=a.count;if(o<0){console.warn("  reached zero @",a.time,u,o),o=0;break}}n.history=r})}return!0},t.unpack.filters=function(e){t.unpack.usages(e),t.unpack.history(e);if(!e.filters)return!1;var n={};e.filters.forEach(function(e){n[e.name]=e,e.usage||(e.usage={})}),e.filtersByName=n;if(e["filter usage"]instanceof Array){e["filter usage"].forEach(function(e){var t=e.label;for(var r in e.counts)r in n?n[r].usage[t]=e.counts[r]:console.warn("filter usage (no filter):",r,e.counts[r])});if(e.currentUsage){var r=e.currentUsage.label;e.filters.forEach(function(e){e.count=e.usage[r]})}}e.filters.forEach(function(n){n.id||(n.id=n.name.replace(/\W+/g,"_").toLowerCase()),n.tpm=n.history[n.history.length-1];var r=t.util.sum(n.history);n.total||(n.total=r);var i=n.total-r;i<0&&(console.warn("negative running count start:",i,"(count:",n.total,"; sum history:",r,")"),i=0),n.counts=n.history.slice(),n.history=t.unpack.runningTotal(n.history,i,e.time);var s={},o={};n.history.forEach(function(e){s[e.time]=e.count,o[e.time]=e.total}),n.countsByTime=s,n.totalsByTime=o});var i={};return e.filters.forEach(function(e){i[e.id]=e}),e.filtersById=i,!0},t.unpack.minutes=function(e){t.unpack.usages(e);if(!e.filters||!e.minutes)return!1;var n={};return e.filters.forEach(function(e){n[e.id]=e}),e.filtersById=n,e.minutes.forEach(function(e){e.filters=e.filters.map(function(e){return{filter:n[e[0]],count:e[1]}})}),e.history=e.minutes.map(function(e){return e.tweets.count}),t.unpack.history(e),!0},t.unpack.retweets=function(e){t.unpack.usages(e),t.unpack.history(e)},t.unpack.usages=function(e){function s(e){return e.start<=n&&e.end>=n||e.end>=n&&e.end<=i}if(!e.history||!e.usage)return!1;var t=e.time,n=t.start||t.start_time,r=t.period,i=n+r*(e.history.length-1),o=null,u=e.usage.sort(function(e,t){var n=t.end-e.end,r=t.start-e.start;return n||r}),a=e.usage.sort(function(e,t){return t.count-e.count});return u.forEach(function(e){e.active=s(e),e.active&&(o=e)}),e.currentUsage=o,e.biggestUsage=a[0],!0},t.unpack.runningTotal=function(e,t,n){var r=t,i=n.start_time,s=n.period;return e.map(function(e){var t=i;return i+=s,r+=e,{count:e,time:t,total:r}})},t.util.qs={parse:function(e){e.charAt(0)==="?"&&(e=e.substr(1));if(e.length===0||e.indexOf("=")===-1)return{};var t=e.split("&"),n=t.length;params={};for(var r=0;r<n;r++){var i=t[r].split("=");params[decodeURIComponent(i[0])]=i.length===2?decodeURIComponent(i[1]):!0}return params},format:function(e){var t=[],n=0;for(var r in e){n++>0&&t.push("&");var i=e[r];i!==null&&t.push(encodeURIComponent(r),"=",encodeURIComponent(i))}return t.join("")}},e.eddy=t,window.console||function(e){function t(){}for(var n=["error","info","log","warn"],r;r=n.pop();)e[r]=e[r]||t}(window.console=window.console={})})(this);